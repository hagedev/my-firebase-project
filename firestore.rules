/**
 * @file Firebase Security Rules for AirCafe - PROTOTYPE MODE.
 *
 * Core Philosophy:
 * This ruleset provides completely open access to the database to any authenticated user.
 * THIS IS FOR DEVELOPMENT PURPOSES ONLY.
 * All reads and writes are allowed for any signed-in user, effectively disabling all security.
 *
 * Data Structure:
 * The database is structured around tenants, users, menus, categories, orders, and tables.
 * Each tenant has its own set of menus, categories, orders, and tables.
 * Users are either superadmins (with access to all tenants) or admin_kafe (with access only to their assigned tenant).
 *
 * Key Security Decisions:
 * - No authorization checks are performed.
 * - All data is accessible to any signed-in user.
 * - This ruleset is intended for rapid prototyping only and MUST be replaced with a more secure ruleset before deployment.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows any signed-in user to read and write tenant data.
     * @path /tenants/{tenantId}
     * @allow (get, list, create, update, delete): Any signed-in user.
     * @deny (none): This rule allows any authenticated user.
     * @principle Grants full access to any signed-in user.
     */
    match /tenants/{tenantId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any signed-in user to read and write user data.
     * @path /users/{userId}
     * @allow (get, list, create, update, delete): Any signed-in user.
     * @deny (none): This rule allows any authenticated user.
     * @principle Grants full access to any signed-in user.
     */
    match /users/{userId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any signed-in user to read and write menu data.
     * @path /tenants/{tenantId}/menus/{menuId}
     * @allow (get, list, create, update, delete): Any signed-in user.
     * @deny (none): This rule allows any authenticated user.
     * @principle Grants full access to any signed-in user.
     */
    match /tenants/{tenantId}/menus/{menuId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any signed-in user to read and write category data.
     * @path /tenants/{tenantId}/categories/{categoryId}
     * @allow (get, list, create, update, delete): Any signed-in user.
     * @deny (none): This rule allows any authenticated user.
     * @principle Grants full access to any signed-in user.
     */
    match /tenants/{tenantId}/categories/{categoryId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any signed-in user to read and write order data.
     * @path /tenants/{tenantId}/orders/{orderId}
     * @allow (get, list, create, update, delete): Any signed-in user.
     * @deny (none): This rule allows any authenticated user.
     * @principle Grants full access to any signed-in user.
     */
    match /tenants/{tenantId}/orders/{orderId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any signed-in user to read and write table data.
     * @path /tenants/{tenantId}/tables/{tableId}
     * @allow (get, list, create, update, delete): Any signed-in user.
     * @deny (none): This rule allows any authenticated user.
     * @principle Grants full access to any signed-in user.
     */
    match /tenants/{tenantId}/tables/{tableId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }
    /**
     * @description Allows any signed-in user to read and write superadmin role data.
     * @path /roles_superadmin/{userId}
     * @allow (get, list, create, update, delete): Any signed-in user.
     * @deny (none): This rule allows any authenticated user.
     * @principle Grants full access to any signed-in user.
     */
        match /roles_superadmin/{userId} {
            allow get, list: if isSignedIn();
            allow create, update, delete: if isSignedIn();
        }
  }

  function isSignedIn() {
    return request.auth != null;
  }

}